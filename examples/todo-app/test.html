<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <h1>Debug Test</h1>
  <div id="root"></div>
  <div id="log" style="margin-top: 2rem; background: white; padding: 1rem; border-radius: 0.5rem;"></div>

  <script type="module">
    const log = (msg) => {
      console.log(msg);
      document.getElementById('log').innerHTML += `<div>${msg}</div>`;
    };

    log('1. Starting...');

    try {
      log('2. Importing WASM runtime...');
      const { createSignal, render, createElement, initWasm } = await import('./src/velocity-wasm-runtime.ts');
      log('3. ✅ Import successful');

      log('4. Initializing WASM...');
      await initWasm();
      log('5. ✅ WASM initialized');

      log('6. Creating signal...');
      const [count, setCount] = createSignal(0);
      log('7. ✅ Signal created');

      log('8. Testing signal get...');
      const value = count();
      log(`9. ✅ Signal value: ${value}`);

      log('10. Testing signal set...');
      setCount(42);
      const newValue = count();
      log(`11. ✅ New signal value: ${newValue}`);

      log('12. Creating component...');
      function TestComponent() {
        log('   → TestComponent called');
        const el = createElement('div', null,
          createElement('h2', null, 'Test Component'),
          createElement('p', null, 'Count: ', count),
          createElement('button', {
            onClick: () => {
              log('Button clicked!');
              setCount(count() + 1);
            }
          }, 'Increment')
        );
        log('   → Component element created');
        return el;
      }

      log('13. Calling render...');
      await render(() => TestComponent(), document.getElementById('root'));
      log('14. ✅ Render complete!');

    } catch (e) {
      log(`❌ ERROR: ${e.message}`);
      log(`Stack: ${e.stack}`);
      console.error(e);
    }
  </script>
</body>
</html>
